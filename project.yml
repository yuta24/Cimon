main_target: &main_target Cimon

name: *main_target
options:
  minimumXcodeGenVersion: 2.5.0
  carthageExecutablePath: mint run Carthage/Carthage carthage
  bundleIdPrefix: com.bivre
  deploymentTarget:
    iOS: "11.0"
settings:
  DEVELOPMENT_TEAM: PS98BD6732
  CODE_SIGN_STYLE: Automatic
targets:
  Cimon:
    type: application
    platform: iOS
    sources:
      - path: Cimon
      - path: GoogleService-Info.plist
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon
    dependencies:
      - target: Shared
      - target: TravisCIAPI
      - target: CircleCIAPI
      - target: BitriseAPI
      - target: Domain
      - target: App
      - carthage: APIKit
      - carthage: Nuke
      - carthage: Pipeline
      - carthage: ReactiveSwift
    prebuildScripts:
      - name: "[SwiftLint] Run Script"
        script: |
          mint run realm/SwiftLint swiftlint
    scheme:
      testTargets:
        - CimonTests
        - SharedTests
        - DomainTests
        - AppTests
  CimonTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: CimonTests
    dependencies:
      - target: *main_target
  Shared:
    type: framework
    platform: iOS
    sources:
      - path: Shared
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.shared
    scheme:
      testTargets:
        - SharedTests
  SharedTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: SharedTests
    dependencies:
      - target: *main_target
      - target: Shared
  Domain:
    type: framework
    platform: iOS
    sources:
      - path: Domain
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.domain
    dependencies:
      - target: Shared
    scheme:
      testTargets:
        - DomainTests
  DomainTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: DomainTests
    dependencies:
      - target: *main_target
      - target: Domain
  App:
    type: framework
    platform: iOS
    sources:
      - path: App
      - path: App/Sources/Generated/Assets.swift
        optional: true
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.app
    dependencies:
      - target: Shared
      - target: Domain
      - target: TravisCIAPI
      - target: CircleCIAPI
      - target: BitriseAPI
      - carthage: APIKit
      - carthage: Nuke
      - carthage: Pipeline
      - carthage: ReactiveSwift
    prebuildScripts:
      - name: "[SwiftGen] Run Script"
        script: |
          mint run SwiftGen/SwiftGen swiftgen config run --config App/swiftgen.yml
    scheme:
      testTargets:
        - AppTests
  AppTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: AppTests
    dependencies:
      - target: *main_target
      - target: App
  BitriseAPI:
    type: framework
    platform: iOS
    sources:
      - path: BitriseAPI
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.bitrise
    dependencies:
      - carthage: APIKit
  CircleCIAPI:
    type: framework
    platform: iOS
    sources:
      - path: CircleCIAPI
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.circleci
    dependencies:
      - carthage: APIKit
  TravisCIAPI:
    type: framework
    platform: iOS
    sources:
      - path: TravisCIAPI
    settings:
      PRODUCT_BUNDLE_IDENTIFIER: com.bivre.cimon.travisci
    dependencies:
      - carthage: APIKit
